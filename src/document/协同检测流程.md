# 目前需要做的

1、创建任务后并自动连接后，参与任务内容默认填上

2、创建任务长链接改为全局的

3、参与任务时，如果这个桥梁已存在则默认开始(目前是这么做的)，存在问题

4、创建任务和参与任务之后，再次打开窗口，默认开始协同检测

5、创建人可以看到创建任务页面，参与人不可以看到创建任务页面

6、数据传递模式



# 流程梳理

## 一、创建任务与参与任务

### 1、入口

桥梁管理页面 - 右下角

未选择桥梁时点击，显示参与项目页

选择桥梁时点击，如果本地不存在协同桥梁或当前桥梁正在检测中，显示创建任务页面；如果选中的桥梁不是当前检测的桥梁，提示当前检测桥梁信息

### 2、打开窗口时的数据

读取本地协同检测数据，设置创建任务页面和参与任务页面数据

### 3、创建任务确认

协同码为自动生成

确认前校验是否有桥梁数据、创建者姓名，校验网络连接状态

获取wifi的ip作为接口访问ip

### 4、创建任务流程

a. 请求创建任务接口并传入协同人数、初始桥梁数据，创建房间，获取四位房间号

b. 将协调检测信息存入数据库协同检测表，如果数据库中没有这个桥梁的检测数据(判断bridgereportid)，那么将直接存入数据库，如果有检测数据那么修改数据

c.将协同检测信息存入数据库

d.设置创建任务页的任务号

f. 自动加入任务

### 5、初始桥梁数据处理

a.判断是否有检测数据，没有则创建

b.合并桥梁信息

### 6、自动加入任务流程

a.携带房间号请求加入房间接口，获取ws地址 "/task_room/1201/"

b.对获取的ws地址进行拼接，并存入本地

c.建立长链接

### 7、参与任务流程

a.校验数据与网络状态

b.获取wifi的ip

c..携带房间号请求加入房间接口，获取桥梁数据 及  ws地址 "/task_room/1201/"

d.处理获取的桥梁数据

f.建立长链接(全局)

### 8、处理获取的桥梁数据流程

判断桥梁表中是否存在这个桥梁，如果存在则默认加入任务，不存在则以下流程

